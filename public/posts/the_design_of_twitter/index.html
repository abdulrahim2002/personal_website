<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/personal_website/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=personal_website/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>The design of twitter | Abdul Rahim</title>
<meta name="keywords" content="software engineering, design">
<meta name="description" content="In this blog post, I try to decode how your tweets are agreegated, and how twitter does it for millions of users in a scalable way">
<meta name="author" content="abdulrahim">
<link rel="canonical" href="http://localhost:1313/personal_website/posts/the_design_of_twitter/">
<link crossorigin="anonymous" href="/personal_website/assets/css/stylesheet.3f7ba6a00d316a1658af1e52b60f5592bfd3f63e1683217d447958625c9fec2a.css" integrity="sha256-P3umoA0xahZYrx5Stg9Vkr/T9j4WgyF9RHlYYlyf7Co=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/personal_website/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/personal_website/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/personal_website/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/personal_website/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/personal_website/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/personal_website/posts/the_design_of_twitter/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/personal_website/posts/the_design_of_twitter/">
  <meta property="og:site_name" content="Abdul Rahim">
  <meta property="og:title" content="The design of twitter">
  <meta property="og:description" content="In this blog post, I try to decode how your tweets are agreegated, and how twitter does it for millions of users in a scalable way">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-24T06:55:19+00:00">
    <meta property="article:modified_time" content="2025-09-24T06:55:19+00:00">
    <meta property="article:tag" content="Software Engineering">
    <meta property="article:tag" content="Design">
      <meta property="og:image" content="http://localhost:1313/personal_website/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/personal_website/images/papermod-cover.png">
<meta name="twitter:title" content="The design of twitter">
<meta name="twitter:description" content="In this blog post, I try to decode how your tweets are agreegated, and how twitter does it for millions of users in a scalable way">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/personal_website/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "The design of twitter",
      "item": "http://localhost:1313/personal_website/posts/the_design_of_twitter/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "The design of twitter",
  "name": "The design of twitter",
  "description": "In this blog post, I try to decode how your tweets are agreegated, and how twitter does it for millions of users in a scalable way",
  "keywords": [
    "software engineering", "design"
  ],
  "articleBody": "Introduction Firstly I would like to talk about the scale of twitter, which will help us to understand the requirements of a system like twitter.\nTwitter handles about 600 tweets per second. Which means that approximately 600 tweets are made each second. On the contrary, approximately 60,000 tweets are read each second. This clearly shows that twitter is a read heavy system.\nThere are approximately 300 million users of twitter. Some of them are active users (users who frequently visit twitter), while most of them are passive users (i.e. users who’d only visit once in a while, say 1 month).\nFeatures (i.e. Functional requirements) Home timeline\nevery user has a home timeline a home timeline contains tweets from the users, you’ve followed (i.e. your followees), or tweets that are recommended by the twitter recommendation engine For the sake of simplicity, we will not include the tweets from recommendation engine in the home timeline. Therefore, the home timeline shall only include the tweets from your followees.\nUser timeline\neach user has a user timeline user timeline shows the tweets made by you Search timeline\nsuppose you search “world cup” on twitter search, the search results will show you a number of tweets related to “world cup” these tweets are called search timeline Non functional requirements It is clear from the description that we need to optimize our design for the following features:\nscalability: It is clear that you need a scalale system that needs to handle 300 million users availability: If the user is trying to see a tweet. He should be able to see it. You typically do not want to show “Something went wrong” error screens, which will make it a poor user experience eventual consistency: If a tweet is delivered to your followers with a few second delay, it should not be a huge problem (typically) causal consistency: If I make a new tweet, it should be shown to me immediately, or I might make a duplicate new tweet thinking that the previously created tweet was not successfully posted Low level design Considering the non-functional requirements. It should be clear to us, that we would require a No-SQL database, particularly mongo-db or cassandra.\nThis is because, No-SQL databases are easier to scale, and both mongodb and cassandra are build to favour availability over consistency.\nI wanted to talk about database schema but I would like to emphasize that NoSQL databases do not have a schema in the same sense as a relational database (SQL based) does.\nTherefore, lets rather talk about API endpoints (request/response shapes), since they are database agnostic.\nUser We should be able to fetch a user by a user id or email. A typical response would look like:\n1 2 3 4 5 6 7 8 9 10 11 12 { \"user_id\": 1231231, \"email\": \"sample@example.com\", \"name\": \"sample\", \"followees\": [ 123, 321, 321, // a list of users, current user follows ], // other metadata \"phone\": \"+12 123124214\", \"created_at\": 2143124214124, } Tweet Each tweet, has a limit of 140 characters. And each tweet can contain images/videos. The basic structure defining a tweet object might look like the following:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 { \"tweet_id\": 1231232, \"text\": \"the text of the tweet is stored in this field\", \"images\": [ \"https://twitter.com/user-data/images/\", \"https://twitter.com/user-data/images/\" // a list of paths to images in this post. ], \"videos\": [ \"https://twitter.com/user-data/videos/\", \"https://twitter.com/user-data/videos/\" // a list of paths to videos in this tweet. ] } User timeline We should be able to retrieve all the posts, made by a particular user. Since, there may be a large number of tweets/posts, we can also implement pagination functionality. A sample REST API response might look like:\nRequest:\n1 2 3 4 5 6 /user-timeline POST { \"user_id\": 123123, // filter conditions } Response:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 { \"123123\": { \"tweet_id\": 123123, \"text\": \"some text of tweet 1\", \"images\": [ // list of paths to images ], \"videos\": [ // list of paths to videos ] }, \"321321\": { \"tweet_id\": 321321, \"text\": \"some text of tweet 2\", \"images\": [ // list of paths to images ], \"videos\": [ // list of paths to videos ] }, // and many more tweets in the form // \"tweet_id\": { Tweet Object } } How to generate home page timeline/feed Suppose we need to generate the feed for alice. Support alice follows bob and charlie. Therefore, in our simplified twitter, alice should see more recent (say 20) posts from bob and charlie.\nWhen we need to generate the home feed for alice, the simplest option is to use the following algorithm:\nFind the friends of alice, using the “followees” field. This will provide us user id’s of bob and charlie Now get all the tweets from bob and charlie using their user timelines respectively (this will involve a database call) Sort the agreegated tweets from bob and charlie and return top 20 tweets. In fact, I previously solved a similar problem on leetcode. And this was the solution I came up with (which follows the above algorithm):\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 interface Post { // each post has an id and timestamp id: number, sno: number, } interface User { // store ID's of users this user follows followees: Set\u003cnumber\u003e, // store tweetID's of tweets made by user posts: Post[], } class Twitter { // to be able to get User object from UserID private usersList: Map\u003cnumber, User\u003e = new Map(); private postSerialNumber: number = 0; postTweet(userId: number, tweetId: number): void { if ( !this.usersList.has( userId ) ) this.createUser( userId ); const curUser: User = this.usersList.get( userId ); const tweet: Post = { id: tweetId, sno: this.postSerialNumber++, } curUser.posts.push( tweet ); } getNewsFeed(userId: number): number[] { if ( !this.usersList.has( userId ) ) return []; const feed: Post[] = []; const curUser: User = this.usersList.get( userId ); curUser.followees.forEach( (followeeId) =\u003e { // the the posts of this followee and add that to feed const followee: User = this.usersList.get( followeeId ); feed.push( ...followee.posts ); } ); // sort the posts by serial no. and return the top 10 posts feed.sort( (a,b) =\u003e b.sno - a.sno ); return feed.slice( 0, 10 ).map( x =\u003e x.id ); } follow(followerId: number, followeeId: number): void { if ( !this.usersList.has(followerId) ) this.createUser( followerId ); if ( !this.usersList.has(followeeId) ) this.createUser( followeeId ); const curUser: User = this.usersList.get( followerId ); curUser.followees.add( followeeId ); } unfollow(followerId: number, followeeId: number): void { const curUser: User = this.usersList.get( followerId ); curUser.followees.delete( followeeId ); } createUser( userId: number ) { const newUser: User = { followees: new Set( [userId] ), posts: [], } this.usersList.set( userId, newUser ); } } The problem with this approach is that:\nthis is an expensive operation. For a user with 30 followees, we are making 30 expensive database calls. And then we also need to sort the tweets. it generates the home feed on the fly (expensive operation -\u003e will make user wait) To improve the performance of the above approach, the idea is to keep each user’s timeline (both home timeline and user tiemline) in a redis.\nWhenever, bob or charlie post a new tweet. A fanout service picks up the new tweet and populates it in alice’s home feed.\nBut even with this approach, there is one problem. Consider a famous user who has 100 million followers. Now when he tweets, the fanout service needs to update the timeline of 100 million users. This is an increadibly expensive operation.\nThe solution is to segregate users into regular users and famous users. The fanout method should only run with regular users. To collate the tweets by famous users, we should fetch them on the fly. Therefore, the home timeline generation service would typically keep a seperate list for famous followees for a given user. And the tweets from famous users is fetched on the fly combined with precomputed home feed from redis (which only contains tweets from regular users).\nThis approach, also enables us to distribute the tweets of famous users using a more optimal method, for example through CDN.\nLastly, I would like to note that publisher/subscriber model of communication, is probably a more natural approach to solve these kind of problems.\neach user is a publisher and his followers are his subscribers when alice follows bob. She is subscribing to bob. Therefore: bob -\u003e publisher alice -\u003e subscriber when bob makes a post. All subscribers that subscriber to bob’s post immediately take some action For example, when bob makes a post, alice can store the post in her timeline Since, we will be handling 300 million users, we potentially have 300 million publisher streams and 300 million subscriber streams. Hence, a huge pub/sub system is required.\nWe can think of using something like apache kafka. Which is a production grade pub/sub system. But even with kafka, this might be a challenge, given the number of publisher stremas we need to maintain. So as a home work, read more about kafka.\nHow to generate search timeline/feed Twitter uses something called inverted full text search. Here’s how it works:\nWhen you make a tweet. Twitter does the following:\nidentify the terms within your tweet, that can be used to index your tweet. For example, I you tweet:\n1 I am supporing manchester united this season. Then twitter parser may identify “manchester united” as the main search key for this tweet. Note that there may be multiple search keys.\nThen it stores the search_key : tweet mapping, into a key value store.\nFor each search_key there is a list of tweets that contain that search key. Similarly, your tweet will be appended to the list of tweets, under the search key “manchester united”\n1 2 3 // key value store \"machester united\": [123, 321, 422, ... /* other tweet id's that talk about manchester united*/ ] // other search_keys along with thir tweets Now whenever, a user searches for “manchester united”. Twitter can just fetch the list of tweets from the above key value store. And your tweet will be displayed in the results (based on some raking)\nYou might have already observed, that such a key-value store needs to be of massive scale considering we are dealing with 300 million users. And that’s why, this key-value store is not located in a single place. This is probably spread across multiple nodes and data centres.\nTherefore, twitter uses an approch of scatter and gather when writing and reading from this distributed key-value store.\nFor a given query, each datacenter is asked to provide a list of relavant tweets from it’s databases. These are merged together and finally shown to the user after being ranked.\n",
  "wordCount" : "1869",
  "inLanguage": "en",
  "image": "http://localhost:1313/personal_website/images/papermod-cover.png","datePublished": "2025-09-24T06:55:19.889Z",
  "dateModified": "2025-09-24T06:55:19.889Z",
  "author":{
    "@type": "Person",
    "name": "abdulrahim"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/personal_website/posts/the_design_of_twitter/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Abdul Rahim",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/personal_website/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/personal_website/" accesskey="h" title="Abdul Rahim (Alt + H)">Abdul Rahim</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/personal_website/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/docs/resume.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">



<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/personal_website/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/personal_website/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      The design of twitter
    </h1>
    <div class="post-description">
      In this blog post, I try to decode how your tweets are agreegated, and how twitter does it for millions of users in a scalable way
    </div>
    <div class="post-meta"><span title='2025-09-24 06:55:19.889 +0000 UTC'>September 24, 2025</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;abdulrahim

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#features-ie-functional-requirements" aria-label="Features (i.e. Functional requirements)">Features (i.e. Functional requirements)</a></li>
                <li>
                    <a href="#non-functional-requirements" aria-label="Non functional requirements">Non functional requirements</a></li>
                <li>
                    <a href="#low-level-design" aria-label="Low level design">Low level design</a></li>
                <li>
                    <a href="#how-to-generate-home-page-timelinefeed" aria-label="How to generate home page timeline/feed">How to generate home page timeline/feed</a></li>
                <li>
                    <a href="#how-to-generate-search-timelinefeed" aria-label="How to generate search timeline/feed">How to generate search timeline/feed</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h2>
<p>Firstly I would like to talk about the scale of twitter, which will help
us to understand the requirements of a system like twitter.</p>
<p>Twitter handles about 600 tweets per second. Which means that
approximately 600 tweets are made each second. On the contrary,
approximately 60,000 tweets are read each second. This clearly shows
that twitter is a read heavy system.</p>
<p>There are approximately 300 million users of twitter.  Some of them are
active users (users who frequently visit twitter), while most of them
are passive users (i.e. users who&rsquo;d only visit once in a while, say 1
month).</p>
<h2 id="features-ie-functional-requirements">Features (i.e. Functional requirements)<a hidden class="anchor" aria-hidden="true" href="#features-ie-functional-requirements">#</a></h2>
<ol>
<li>
<p>Home timeline</p>
<ul>
<li>every user has a home timeline</li>
<li>a home timeline contains tweets from the users, you&rsquo;ve followed
(i.e. your followees), or tweets that are recommended by the
twitter recommendation engine</li>
</ul>
</li>
</ol>
<p>For the sake of simplicity, we will not include the tweets from
recommendation engine in the home timeline. Therefore, the home timeline
shall only include the tweets from your followees.</p>
<ol start="2">
<li>
<p>User timeline</p>
<ul>
<li>each user has a user timeline</li>
<li>user timeline shows the tweets made by you</li>
</ul>
</li>
<li>
<p>Search timeline</p>
<ul>
<li>suppose you search &ldquo;world cup&rdquo; on twitter search, the search
results will show you a number of tweets related to &ldquo;world cup&rdquo;</li>
<li>these tweets are called search timeline</li>
</ul>
</li>
</ol>
<h2 id="non-functional-requirements">Non functional requirements<a hidden class="anchor" aria-hidden="true" href="#non-functional-requirements">#</a></h2>
<p>It is clear from the description that we need to optimize our design for
the following features:</p>
<ul>
<li>scalability: It is clear that you need a scalale system that needs to
handle 300 million users</li>
<li>availability: If the user is trying to see a tweet. He should be able
to see it. You typically do not want to show &ldquo;Something went wrong&rdquo;
error screens, which will make it a poor user experience</li>
<li>eventual consistency: If a tweet is delivered to your followers with a
few second delay, it should not be a huge problem (typically)</li>
<li>causal consistency: If I make a new tweet, it should be shown to me
immediately, or I might make a duplicate new tweet thinking that the
previously created tweet was not successfully posted</li>
</ul>
<h2 id="low-level-design">Low level design<a hidden class="anchor" aria-hidden="true" href="#low-level-design">#</a></h2>
<p>Considering the non-functional requirements. It should be clear to us,
that we would require a No-SQL database, particularly mongo-db or
cassandra.</p>
<p>This is because, No-SQL databases are easier to scale, and both mongodb
and cassandra are build to favour availability over consistency.</p>
<p>I wanted to talk about database schema but I would like to emphasize
that NoSQL databases do not have a schema in the same sense as a
relational database (SQL based) does.</p>
<p>Therefore, lets rather talk about API endpoints (request/response
shapes), since they are database agnostic.</p>
<ol>
<li>User</li>
</ol>
<p>We should be able to fetch a user by a user id or email. A typical
response would look like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;user_id&#34;</span><span class="p">:</span> <span class="mi">1231231</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;email&#34;</span><span class="p">:</span> <span class="s2">&#34;sample@example.com&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;sample&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;followees&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="mi">123</span><span class="p">,</span> <span class="mi">321</span><span class="p">,</span> <span class="mi">321</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// a list of users, current user follows
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// other metadata
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nt">&#34;phone&#34;</span><span class="p">:</span> <span class="s2">&#34;+12 123124214&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;created_at&#34;</span><span class="p">:</span> <span class="mi">2143124214124</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>Tweet</li>
</ol>
<p>Each tweet, has a limit of 140 characters. And each tweet can contain
images/videos. The basic structure defining a tweet object might look
like the following:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;tweet_id&#34;</span><span class="p">:</span> <span class="mi">1231232</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;the text of the tweet is stored in this field&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;images&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://twitter.com/user-data/images/&lt;image_id&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://twitter.com/user-data/images/&lt;image_id&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// a list of paths to images in this post.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;videos&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://twitter.com/user-data/videos/&lt;video_id&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;https://twitter.com/user-data/videos/&lt;video_id&gt;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// a list of paths to videos in this tweet.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>User timeline</li>
</ol>
<p>We should be able to retrieve all the posts, made by a particular user.
Since, there may be a large number of tweets/posts, we can also
implement pagination functionality. A sample REST API response might
look like:</p>
<p>Request:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">/user-timeline</span> <span class="err">POST</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;user_id&#34;</span><span class="p">:</span> <span class="mi">123123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// filter conditions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Response:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;123123&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tweet_id&#34;</span><span class="p">:</span> <span class="mi">123123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;some text of tweet 1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;images&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// list of paths to images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;videos&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// list of paths to videos
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;321321&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;tweet_id&#34;</span><span class="p">:</span> <span class="mi">321321</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;text&#34;</span><span class="p">:</span> <span class="s2">&#34;some text of tweet 2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;images&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// list of paths to images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;videos&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// list of paths to videos
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// and many more tweets in the form
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// &#34;tweet_id&#34;: { Tweet Object }
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="how-to-generate-home-page-timelinefeed">How to generate home page timeline/feed<a hidden class="anchor" aria-hidden="true" href="#how-to-generate-home-page-timelinefeed">#</a></h2>
<p>Suppose we need to generate the feed for alice. Support alice follows
bob and charlie. Therefore, in our simplified twitter, alice should see
more recent (say 20) posts from bob and charlie.</p>
<p><img alt="Alice follows bob and charlie" loading="lazy" src="https://i.ibb.co/5WvZWw27/Screenshot-from-2025-09-24-14-51-23.png"></p>
<p>When we need to generate the home feed for alice, the simplest option is
to use the following algorithm:</p>
<ol>
<li>Find the friends of <code>alice</code>, using the &ldquo;followees&rdquo; field. This will
provide us user id&rsquo;s of <code>bob</code> and <code>charlie</code></li>
<li>Now get all the tweets from <code>bob</code> and <code>charlie</code> using their user
timelines respectively (this will involve a database call)</li>
<li>Sort the agreegated tweets from bob and charlie and return top 20
tweets.</li>
</ol>
<p>In fact, I previously solved a <a href="https://leetcode.com/problems/design-twitter/description">similar problem on
leetcode</a>. And
this was the solution I came up with (which follows the above
algorithm):</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">interface</span> <span class="n">Post</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">each</span> <span class="n">post</span> <span class="n">has</span> <span class="n">an</span> <span class="n">id</span> <span class="ow">and</span> <span class="n">timestamp</span>
</span></span><span class="line"><span class="cl">    <span class="n">id</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">sno</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">interface</span> <span class="n">User</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">store</span> <span class="n">ID</span><span class="s1">&#39;s of users this user follows</span>
</span></span><span class="line"><span class="cl">    <span class="n">followees</span><span class="p">:</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">number</span><span class="o">&gt;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">store</span> <span class="n">tweetID</span><span class="s1">&#39;s of tweets made by user</span>
</span></span><span class="line"><span class="cl">    <span class="n">posts</span><span class="p">:</span> <span class="n">Post</span><span class="p">[],</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="n">Twitter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="n">to</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span> <span class="n">get</span> <span class="n">User</span> <span class="n">object</span> <span class="n">from</span> <span class="n">UserID</span>
</span></span><span class="line"><span class="cl">    <span class="n">private</span> <span class="n">usersList</span><span class="p">:</span> <span class="n">Map</span><span class="o">&lt;</span><span class="n">number</span><span class="p">,</span> <span class="n">User</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">private</span> <span class="n">postSerialNumber</span><span class="p">:</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">postTweet</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span> <span class="n">tweetId</span><span class="p">:</span> <span class="n">number</span><span class="p">):</span> <span class="n">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">has</span><span class="p">(</span> <span class="n">userId</span> <span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">this</span><span class="o">.</span><span class="n">createUser</span><span class="p">(</span> <span class="n">userId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">curUser</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">userId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">tweet</span><span class="p">:</span> <span class="n">Post</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">id</span><span class="p">:</span> <span class="n">tweetId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="n">sno</span><span class="p">:</span> <span class="n">this</span><span class="o">.</span><span class="n">postSerialNumber</span><span class="o">++</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">curUser</span><span class="o">.</span><span class="n">posts</span><span class="o">.</span><span class="n">push</span><span class="p">(</span> <span class="n">tweet</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">getNewsFeed</span><span class="p">(</span><span class="n">userId</span><span class="p">:</span> <span class="n">number</span><span class="p">):</span> <span class="n">number</span><span class="p">[]</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">has</span><span class="p">(</span> <span class="n">userId</span> <span class="p">)</span> <span class="p">)</span> 
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">feed</span><span class="p">:</span> <span class="n">Post</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">curUser</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">userId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">curUser</span><span class="o">.</span><span class="n">followees</span><span class="o">.</span><span class="n">forEach</span><span class="p">(</span> <span class="p">(</span><span class="n">followeeId</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">//</span> <span class="n">the</span> <span class="n">the</span> <span class="n">posts</span> <span class="n">of</span> <span class="n">this</span> <span class="n">followee</span> <span class="ow">and</span> <span class="n">add</span> <span class="n">that</span> <span class="n">to</span> <span class="n">feed</span>
</span></span><span class="line"><span class="cl">            <span class="k">const</span> <span class="n">followee</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">followeeId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">feed</span><span class="o">.</span><span class="n">push</span><span class="p">(</span> <span class="o">...</span><span class="n">followee</span><span class="o">.</span><span class="n">posts</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="o">//</span> <span class="n">sort</span> <span class="n">the</span> <span class="n">posts</span> <span class="n">by</span> <span class="n">serial</span> <span class="n">no</span><span class="o">.</span> <span class="ow">and</span> <span class="k">return</span> <span class="n">the</span> <span class="n">top</span> <span class="mi">10</span> <span class="n">posts</span>
</span></span><span class="line"><span class="cl">        <span class="n">feed</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">b</span><span class="o">.</span><span class="n">sno</span> <span class="o">-</span> <span class="n">a</span><span class="o">.</span><span class="n">sno</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">feed</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span> <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span><span class="o">.</span><span class="n">id</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">follow</span><span class="p">(</span><span class="n">followerId</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span> <span class="n">followeeId</span><span class="p">:</span> <span class="n">number</span><span class="p">):</span> <span class="n">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">followerId</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">this</span><span class="o">.</span><span class="n">createUser</span><span class="p">(</span> <span class="n">followerId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">has</span><span class="p">(</span><span class="n">followeeId</span><span class="p">)</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">this</span><span class="o">.</span><span class="n">createUser</span><span class="p">(</span> <span class="n">followeeId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">curUser</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">followerId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">curUser</span><span class="o">.</span><span class="n">followees</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">followeeId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">unfollow</span><span class="p">(</span><span class="n">followerId</span><span class="p">:</span> <span class="n">number</span><span class="p">,</span> <span class="n">followeeId</span><span class="p">:</span> <span class="n">number</span><span class="p">):</span> <span class="n">void</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">curUser</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">followerId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">curUser</span><span class="o">.</span><span class="n">followees</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span> <span class="n">followeeId</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">createUser</span><span class="p">(</span> <span class="n">userId</span><span class="p">:</span> <span class="n">number</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="n">newUser</span><span class="p">:</span> <span class="n">User</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">followees</span><span class="p">:</span> <span class="n">new</span> <span class="n">Set</span><span class="p">(</span> <span class="p">[</span><span class="n">userId</span><span class="p">]</span> <span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="n">posts</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="n">this</span><span class="o">.</span><span class="n">usersList</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">userId</span><span class="p">,</span> <span class="n">newUser</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The problem with this approach is that:</p>
<ol>
<li>this is an expensive operation. For a user with 30 followees, we are
making 30 expensive database calls. And then we also need to sort the
tweets.</li>
<li>it generates the home feed on the fly (expensive operation -&gt; will
make user wait)</li>
</ol>
<p>To improve the performance of the above approach, the idea is to keep
each user&rsquo;s timeline (both home timeline and user tiemline) in a redis.</p>
<p><img alt="All home/user timelines/feeds are redis\ninstances" loading="lazy" src="https://i.ibb.co/93VmrnYB/Screenshot-from-2025-09-24-15-18-45.png"></p>
<p>Whenever, bob or charlie post a new tweet. A <strong>fanout</strong> service picks up
the new tweet and populates it in alice&rsquo;s home feed.</p>
<p><img alt="When bob posts a tweet. Fanout service automatically populates alice&rsquo;s\nfeed with\nit" loading="lazy" src="https://i.ibb.co/mFvWB658/Screenshot-from-2025-09-24-15-23-32.png"></p>
<p><img alt="Similarly, tweet made by charlie is populated in alice&rsquo;s home\nfeed" loading="lazy" src="https://i.ibb.co/W4d3bX1Q/Screenshot-from-2025-09-24-15-27-06.png"></p>
<p>But even with this approach, there is one problem. Consider a famous
user who has 100 million followers. Now when he tweets, the fanout
service needs to update the timeline of 100 million users. This is an
increadibly expensive operation.</p>
<p>The solution is to segregate users into regular users and famous users.
The fanout method should only run with regular users. To collate the
tweets by famous users, we should <code>fetch them on the fly</code>. Therefore,
the home timeline generation service would typically keep a seperate
list for famous followees for a given user. And the tweets from famous
users is fetched on the fly combined with precomputed home feed from
redis (which only contains tweets from regular users).</p>
<p>This approach, also enables us to distribute the tweets of famous users
using a more optimal method, for example through CDN.</p>
<p>Lastly, I would like to note that publisher/subscriber model of
communication, is probably a more natural approach to solve these kind
of problems.</p>
<ul>
<li>each user is a publisher</li>
<li>and his followers are his subscribers</li>
<li>when alice follows bob. She is subscribing to bob. Therefore:
<ul>
<li>bob -&gt; publisher</li>
<li>alice -&gt; subscriber</li>
</ul>
</li>
<li>when bob makes a post. All subscribers that subscriber to bob&rsquo;s post
immediately take some action</li>
<li>For example, when bob makes a post, alice can store the post in her
timeline</li>
</ul>
<p>Since, we will be handling 300 million users, we potentially have 300
million publisher streams and 300 million subscriber streams. Hence, a
huge pub/sub system is required.</p>
<p>We can think of using something like apache kafka. Which is a production
grade pub/sub system. But even with kafka, this might be a challenge,
given the number of publisher stremas we need to maintain.  So as a home
work, read more about kafka.</p>
<h2 id="how-to-generate-search-timelinefeed">How to generate search timeline/feed<a hidden class="anchor" aria-hidden="true" href="#how-to-generate-search-timelinefeed">#</a></h2>
<p>Twitter uses something called inverted full text search. Here&rsquo;s how it
works:</p>
<p>When you make a tweet. Twitter does the following:</p>
<ul>
<li>
<p>identify the terms within your tweet, that can be used to index your
tweet. For example, I you tweet:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">  I am supporing manchester united this season.
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>Then twitter parser may identify &ldquo;manchester united&rdquo; as the main
search key for this tweet. Note that there may be multiple search
keys.</p>
</li>
<li>
<p>Then it stores the <code>search_key : tweet</code> mapping, into a key value
store.</p>
<p>For each <code>search_key</code> there is a list of tweets that contain that
search key. Similarly, your tweet will be appended to the list of
tweets, under the search key &ldquo;manchester united&rdquo;</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// key value store
</span></span><span class="line"><span class="cl">&#34;machester united&#34;: [123, 321, 422, ... /* other tweet id&#39;s that talk about manchester united*/ ]
</span></span><span class="line"><span class="cl">// other search_keys along with thir tweets
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now whenever, a user searches for &ldquo;manchester united&rdquo;. Twitter can just
fetch the list of tweets from the above key value store. And your tweet
will be displayed in the results (based on some raking)</p>
<p>You might have already observed, that such a key-value store needs to be
of massive scale considering we are dealing with 300 million users. And
that&rsquo;s why, this key-value store is not located in a single place. This
is probably spread across multiple nodes and data centres.</p>
<p>Therefore, twitter uses an approch of scatter and gather when writing
and reading from this distributed key-value store.</p>
<p>For a given query, each datacenter is asked to provide a list of
relavant tweets from it&rsquo;s databases. These are merged together and
finally shown to the user after being ranked.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/personal_website/tags/software-engineering/">Software Engineering</a></li>
      <li><a href="http://localhost:1313/personal_website/tags/design/">Design</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/personal_website/posts/netflix_cdn/">
    <span class="title">« Prev</span>
    <br>
    <span>Netflix CDN</span>
  </a>
  <a class="next" href="http://localhost:1313/personal_website/posts/leetcode_715_range_module/">
    <span class="title">Next »</span>
    <br>
    <span>Leetcode 715: Range Module in 6 line python. The epitome of python sorcery demystified</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on x"
            href="https://x.com/intent/tweet/?text=The%20design%20of%20twitter&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f&amp;hashtags=softwareengineering%2cdesign">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f&amp;title=The%20design%20of%20twitter&amp;summary=The%20design%20of%20twitter&amp;source=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f&title=The%20design%20of%20twitter">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on whatsapp"
            href="https://api.whatsapp.com/send?text=The%20design%20of%20twitter%20-%20http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on telegram"
            href="https://telegram.me/share/url?text=The%20design%20of%20twitter&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share The design of twitter on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=The%20design%20of%20twitter&u=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fthe_design_of_twitter%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/personal_website/">Abdul Rahim</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
