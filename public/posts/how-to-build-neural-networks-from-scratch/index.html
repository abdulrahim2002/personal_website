<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/personal_website/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=personal_website/livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>How to Build Neural Networks From Scratch | Abdul Rahim</title>
<meta name="keywords" content="">
<meta name="description" content="üéì PyTorch CNN Explained from Scratch - Step by Step
I&rsquo;ll explain everything from the absolute basics. No prior PyTorch knowledge required!
üìö Part 1: The Absolute Basics - Understanding the Pieces
1.1 What is a CNN?
A Convolutional Neural Network (CNN) is like a detective that:

Scans an image with small filters to find patterns (edges, textures)
Combines these patterns to recognize objects
Learns which patterns are important for classification

Analogy: Imagine looking for a face in a crowd:">
<meta name="author" content="Abdul">
<link rel="canonical" href="http://localhost:1313/personal_website/posts/how-to-build-neural-networks-from-scratch/">
<link crossorigin="anonymous" href="/personal_website/assets/css/stylesheet.3f7ba6a00d316a1658af1e52b60f5592bfd3f63e1683217d447958625c9fec2a.css" integrity="sha256-P3umoA0xahZYrx5Stg9Vkr/T9j4WgyF9RHlYYlyf7Co=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/personal_website/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/personal_website/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/personal_website/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/personal_website/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/personal_website/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/personal_website/posts/how-to-build-neural-networks-from-scratch/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="http://localhost:1313/personal_website/posts/how-to-build-neural-networks-from-scratch/">
  <meta property="og:site_name" content="Abdul Rahim">
  <meta property="og:title" content="How to Build Neural Networks From Scratch">
  <meta property="og:description" content="üéì PyTorch CNN Explained from Scratch - Step by Step I‚Äôll explain everything from the absolute basics. No prior PyTorch knowledge required!
üìö Part 1: The Absolute Basics - Understanding the Pieces 1.1 What is a CNN? A Convolutional Neural Network (CNN) is like a detective that:
Scans an image with small filters to find patterns (edges, textures) Combines these patterns to recognize objects Learns which patterns are important for classification Analogy: Imagine looking for a face in a crowd:">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-12-07T13:17:50+01:00">
    <meta property="article:modified_time" content="2025-12-07T13:17:50+01:00">
      <meta property="og:image" content="http://localhost:1313/personal_website/images/papermod-cover.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/personal_website/images/papermod-cover.png">
<meta name="twitter:title" content="How to Build Neural Networks From Scratch">
<meta name="twitter:description" content="üéì PyTorch CNN Explained from Scratch - Step by Step
I&rsquo;ll explain everything from the absolute basics. No prior PyTorch knowledge required!
üìö Part 1: The Absolute Basics - Understanding the Pieces
1.1 What is a CNN?
A Convolutional Neural Network (CNN) is like a detective that:

Scans an image with small filters to find patterns (edges, textures)
Combines these patterns to recognize objects
Learns which patterns are important for classification

Analogy: Imagine looking for a face in a crowd:">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/personal_website/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "How to Build Neural Networks From Scratch",
      "item": "http://localhost:1313/personal_website/posts/how-to-build-neural-networks-from-scratch/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "How to Build Neural Networks From Scratch",
  "name": "How to Build Neural Networks From Scratch",
  "description": "üéì PyTorch CNN Explained from Scratch - Step by Step I\u0026rsquo;ll explain everything from the absolute basics. No prior PyTorch knowledge required!\nüìö Part 1: The Absolute Basics - Understanding the Pieces 1.1 What is a CNN? A Convolutional Neural Network (CNN) is like a detective that:\nScans an image with small filters to find patterns (edges, textures) Combines these patterns to recognize objects Learns which patterns are important for classification Analogy: Imagine looking for a face in a crowd:\n",
  "keywords": [
    
  ],
  "articleBody": "üéì PyTorch CNN Explained from Scratch - Step by Step I‚Äôll explain everything from the absolute basics. No prior PyTorch knowledge required!\nüìö Part 1: The Absolute Basics - Understanding the Pieces 1.1 What is a CNN? A Convolutional Neural Network (CNN) is like a detective that:\nScans an image with small filters to find patterns (edges, textures) Combines these patterns to recognize objects Learns which patterns are important for classification Analogy: Imagine looking for a face in a crowd:\nFirst, you look for eyes (small patterns) Then, you combine eyes+nose+mouth to find faces Finally, you recognize whose face it is 1.2 Core Components 1.2.1 Images in Computers 1 2 3 4 5 6 7 # An image is just a 3D array of numbers # Shape: [Channels, Height, Width] # Channels: 1 for grayscale, 3 for color (RGB) # Example: A 28x28 grayscale MNIST digit image = torch.randn(1, 28, 28) # 1 channel, 28 height, 28 width print(f\"Image shape: {image.shape}\") 1.2.2 Convolution Operation 1 2 3 4 5 6 7 8 9 10 11 12 13 # A filter is like a magnifying glass that slides over the image # It multiplies numbers and sums them up # Example: Edge detection filter filter_3x3 = torch.tensor([ [-1, -1, -1], [-1, 8, -1], [-1, -1, -1] ]) # When this slides over an image: # It gives high values where there are edges (sudden changes) # It gives low values where the image is smooth 1.3 PyTorch Basics - The Building Blocks 1 2 3 4 5 6 7 8 9 10 11 12 13 import torch import torch.nn as nn # Neural network modules import torch.nn.functional as F # Functions like ReLU, softmax # PyTorch works with TENSORS (fancy arrays) x = torch.tensor([[1, 2], [3, 4]]) # Create a 2x2 tensor print(f\"Tensor shape: {x.shape}\") print(f\"Tensor values:\\n{x}\") # Neural Network Layer layer = nn.Linear(in_features=10, out_features=5) # This creates: output = weight * input + bias # weight shape: [5, 10], bias shape: [5] üèóÔ∏è Part 2: Building a CNN Layer by Layer Let‚Äôs build the simplest possible CNN and understand each part.\n2.1 The Complete Simple CNN - Explained Line by Line 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 class SimpleCNN(nn.Module): def __init__(self): super(SimpleCNN, self).__init__() # Must call this first # ----- LAYER 1: First Convolution ----- # What it does: Looks for simple patterns (edges, corners) self.conv1 = nn.Conv2d( in_channels=1, # Input has 1 channel (grayscale) out_channels=4, # We want 4 different filters kernel_size=3, # Filter is 3x3 pixels padding=1 # Add 1 pixel border to keep same size ) # After this layer: [batch, 1, 28, 28] ‚Üí [batch, 4, 28, 28] # ----- POOLING LAYER ----- # What it does: Makes image smaller, keeps only important info self.pool = nn.MaxPool2d( kernel_size=2, # Look at 2x2 blocks stride=2 # Move 2 pixels each time ) # After pooling: [batch, 4, 28, 28] ‚Üí [batch, 4, 14, 14] # Takes maximum value from each 2x2 block (downsamples) # ----- LAYER 2: Second Convolution ----- # What it does: Looks for more complex patterns (combinations of edges) self.conv2 = nn.Conv2d( in_channels=4, # Input has 4 channels (from previous layer) out_channels=8, # We want 8 different filters kernel_size=3, # Filter is 3x3 padding=1 # Keep same size ) # After: [batch, 4, 14, 14] ‚Üí [batch, 8, 14, 14] # After pooling: [batch, 8, 14, 14] ‚Üí [batch, 8, 7, 7] # ----- FLATTEN LAYER (not really a layer, just reshaping) ----- # What it does: Converts 3D feature maps to 1D vector # [batch, 8, 7, 7] ‚Üí [batch, 8 * 7 * 7] = [batch, 392] # ----- FULLY CONNECTED LAYER 1 ----- # What it does: Combines all features to make decisions self.fc1 = nn.Linear( in_features=8 * 7 * 7, # 392 features from conv layers out_features=64 # 64 neurons in this layer ) # ----- FINAL CLASSIFICATION LAYER ----- # What it does: Decides which digit it is (0-9) self.fc2 = nn.Linear( in_features=64, # From previous layer out_features=10 # 10 classes (digits 0-9) ) def forward(self, x): \"\"\"This defines HOW data flows through the network\"\"\" # x shape starts as: [batch_size, 1, 28, 28] # Step 1: First convolution + activation + pooling x = self.pool(F.relu(self.conv1(x))) # ReLU: Makes negative values 0, keeps positives # Example: ReLU([-2, 0, 5]) = [0, 0, 5] # Step 2: Second convolution + activation + pooling x = self.pool(F.relu(self.conv2(x))) # Step 3: Flatten (3D ‚Üí 1D) x = x.view(-1, 8 * 7 * 7) # -1 means \"figure out batch size automatically\" # Step 4: First fully connected layer + activation x = F.relu(self.fc1(x)) # Step 5: Final classification (no activation here - will add softmax later) x = self.fc2(x) return x 2.2 Let‚Äôs Visualize What Happens Step by Step 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 # Create a mini network to see shapes mini_cnn = SimpleCNN() # Create a fake \"batch\" of 2 images batch_size = 2 fake_images = torch.randn(batch_size, 1, 28, 28) # [2, 1, 28, 28] print(f\"Input shape: {fake_images.shape}\") # Let's trace through manually print(\"\\n=== Tracing the CNN ===\") # After conv1 x = mini_cnn.conv1(fake_images) print(f\"After conv1: {x.shape}\") # [2, 4, 28, 28] # After ReLU (just changes values, not shape) x = F.relu(x) print(f\"After ReLU: {x.shape}\") # Still [2, 4, 28, 28] # After pooling (makes it smaller) x = mini_cnn.pool(x) print(f\"After pool: {x.shape}\") # [2, 4, 14, 14] - HALF the size! # After conv2 x = mini_cnn.conv2(x) print(f\"After conv2: {x.shape}\") # [2, 8, 14, 14] # After pooling again x = mini_cnn.pool(x) print(f\"After pool2: {x.shape}\") # [2, 8, 7, 7] # Flatten x = x.view(batch_size, -1) # -1 means \"figure out this dimension\" print(f\"After flatten: {x.shape}\") # [2, 392] (8*7*7 = 392) # Through fc1 x = mini_cnn.fc1(x) print(f\"After fc1: {x.shape}\") # [2, 64] # Through fc2 (final output) x = mini_cnn.fc2(x) print(f\"After fc2 (final): {x.shape}\") # [2, 10] üéØ Part 3: The Complete Training Process - Explained 3.1 What Does Training Actually Mean? Training = Adjusting the numbers (weights) in the filters to make better predictions\nThink of it like tuning a radio:\nInitial random weights = static noise Training = turning the dial to get clear signal Good weights = clear reception 3.2 The Training Loop - Step by Step 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 # Simplified training example def simple_train(): # 1. CREATE MODEL model = SimpleCNN() # 2. LOSS FUNCTION - Measures how wrong we are criterion = nn.CrossEntropyLoss() # What it does: Compares predictions [0.1, 0.8, 0.1] with true label [0, 1, 0] # Returns a single number: lower is better # 3. OPTIMIZER - Adjusts the weights optimizer = torch.optim.Adam(model.parameters(), lr=0.001) # Adam: Smart gradient descent # lr=0.001: How big of steps to take when adjusting weights # 4. CREATE FAKE DATA (for demonstration) batch_size = 4 images = torch.randn(batch_size, 1, 28, 28) # Random images labels = torch.tensor([3, 7, 2, 9]) # Random labels (digits 0-9) print(f\"Images shape: {images.shape}\") print(f\"Labels: {labels}\") # 5. ONE TRAINING STEP - Explained print(\"\\n=== ONE TRAINING STEP ===\") # Step A: Zero gradients (very important!) optimizer.zero_grad() # Why: PyTorch accumulates gradients. We need to reset them each step. # Step B: Forward pass (make prediction) outputs = model(images) print(f\"Raw outputs shape: {outputs.shape}\") # [4, 10] print(f\"Sample output: {outputs[0]}\") # Step C: Calculate loss (how wrong are we?) loss = criterion(outputs, labels) print(f\"Loss: {loss.item():.4f}\") # Step D: Backward pass (figure out what to adjust) loss.backward() # This calculates gradients: ‚àÇloss/‚àÇweight for EVERY weight # Step E: Update weights (actually adjust them) optimizer.step() # This does: weight = weight - lr * gradient print(\"Weights have been updated! Model learned a little.\") return model # Run it model = simple_train() 3.3 What Happens During Backpropagation? 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # Visual explanation of gradients def explain_gradients(): model = SimpleCNN() # Get one weight from the first convolution filter weight_before = model.conv1.weight[0, 0, 0, 0].item() print(f\"One weight before training: {weight_before:.6f}\") # Do one training step optimizer = torch.optim.Adam(model.parameters(), lr=0.01) criterion = nn.CrossEntropyLoss() # Fake training images = torch.randn(1, 1, 28, 28) labels = torch.tensor([5]) optimizer.zero_grad() outputs = model(images) loss = criterion(outputs, labels) loss.backward() # Look at the gradient for that weight gradient = model.conv1.weight.grad[0, 0, 0, 0].item() print(f\"Gradient for that weight: {gradient:.6f}\") print(\"This tells us: Should we increase or decrease this weight?\") print(f\"Positive gradient ‚Üí Decrease weight\") print(f\"Negative gradient ‚Üí Increase weight\") # Update weights optimizer.step() weight_after = model.conv1.weight[0, 0, 0, 0].item() print(f\"Same weight after training: {weight_after:.6f}\") print(f\"Change: {weight_after - weight_before:.6f}\") explain_gradients() üìä Part 4: Data Loading and Preparation 4.1 Understanding Datasets and DataLoaders 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 from torch.utils.data import Dataset, DataLoader import torchvision.transforms as transforms # A Dataset is like a list of (image, label) pairs # A DataLoader gives you batches of data class SimpleDataset(Dataset): \"\"\"Create your own dataset (for understanding)\"\"\" def __init__(self, num_samples=100): # Create fake data self.images = torch.randn(num_samples, 1, 28, 28) # Random images self.labels = torch.randint(0, 10, (num_samples,)) # Random labels 0-9 def __len__(self): return len(self.images) # How many samples we have def __getitem__(self, idx): return self.images[idx], self.labels[idx] # Get one sample # Create dataset dataset = SimpleDataset(100) print(f\"Dataset has {len(dataset)} samples\") # Create DataLoader dataloader = DataLoader( dataset, batch_size=10, # Give me 10 samples at a time shuffle=True, # Mix them up randomly num_workers=0 # Don't use multiple CPU cores (for simplicity) ) # See what a batch looks like for batch_idx, (images, labels) in enumerate(dataloader): print(f\"\\nBatch {batch_idx}:\") print(f\" Images shape: {images.shape}\") # [10, 1, 28, 28] print(f\" Labels: {labels}\") # [10] if batch_idx == 2: # Just look at first 3 batches break 4.2 Real MNIST Data 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 def load_real_mnist(): \"\"\"Load actual MNIST digits\"\"\" transform = transforms.Compose([ transforms.ToTensor(), # Convert PIL image to tensor transforms.Normalize((0.1307,), (0.3081,)) # Standardize ]) # Download MNIST train_dataset = torchvision.datasets.MNIST( root='./data', train=True, download=True, transform=transform ) print(f\"MNIST has {len(train_dataset)} training images\") # Look at one sample image, label = train_dataset[0] print(f\"\\nFirst sample:\") print(f\" Image shape: {image.shape}\") # [1, 28, 28] print(f\" Label: {label}\") # e.g., 5 print(f\" Image min/max: {image.min():.3f}, {image.max():.3f}\") # Show the image plt.imshow(image.squeeze(), cmap='gray') plt.title(f\"Label: {label}\") plt.show() return train_dataset # Uncomment to run # train_dataset = load_real_mnist() üöÄ Part 5: Complete Working Example - Run This First! Here‚Äôs the simplest complete CNN you can run:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 import torch import torch.nn as nn import torch.nn.functional as F import torch.optim as optim import matplotlib.pyplot as plt import numpy as np # Set random seeds for reproducibility torch.manual_seed(42) np.random.seed(42) # ========== 1. DEFINE THE SIMPLEST CNN ========== class TinyCNN(nn.Module): \"\"\"The smallest possible CNN to understand\"\"\" def __init__(self): super().__init__() # Layer 1: Simple convolution self.conv = nn.Conv2d(1, 3, kernel_size=3, padding=1) # 3 filters # Layer 2: Classification self.fc = nn.Linear(3 * 28 * 28, 10) # 10 classes for digits def forward(self, x): # Apply convolution x = F.relu(self.conv(x)) # Flatten x = x.view(x.size(0), -1) # Flatten all dimensions except batch # Classify x = self.fc(x) return x # ========== 2. CREATE FAKE DATA ========== def create_fake_data(num_samples=100): \"\"\"Create simple fake data for testing\"\"\" # Create random \"images\" images = torch.randn(num_samples, 1, 28, 28) # Like MNIST digits # Create random labels (0-9) labels = torch.randint(0, 10, (num_samples,)) return images, labels # ========== 3. TRAIN FUNCTION ========== def train_one_epoch(model, images, labels): \"\"\"Train for one epoch (one pass through data)\"\"\" criterion = nn.CrossEntropyLoss() optimizer = optim.SGD(model.parameters(), lr=0.01) # Reset gradients optimizer.zero_grad() # Forward pass outputs = model(images) # Calculate loss loss = criterion(outputs, labels) # Backward pass loss.backward() # Update weights optimizer.step() # Calculate accuracy _, predictions = torch.max(outputs, 1) correct = (predictions == labels).sum().item() accuracy = correct / len(labels) * 100 return loss.item(), accuracy # ========== 4. VISUALIZATION ========== def visualize_predictions(model, images, labels): \"\"\"Show what the model predicts\"\"\" model.eval() # Set to evaluation mode with torch.no_grad(): # Don't calculate gradients (faster) outputs = model(images[:5]) # First 5 images _, predictions = torch.max(outputs, 1) # Plot fig, axes = plt.subplots(1, 5, figsize=(15, 3)) for i in range(5): axes[i].imshow(images[i].squeeze(), cmap='gray') axes[i].set_title(f'True: {labels[i]}\\nPred: {predictions[i]}') axes[i].axis('off') plt.show() # ========== 5. MAIN EXECUTION ========== def main(): print(\"=== CNN TUTORIAL - RUN ME! ===\") print(\"\\n1. Creating model...\") model = TinyCNN() print(f\"Model created! It has:\") print(f\" - Conv layer: 3 filters of size 3x3\") print(f\" - FC layer: {3*28*28} inputs ‚Üí 10 outputs\") print(\"\\n2. Creating fake data...\") images, labels = create_fake_data(50) print(f\" Created {len(images)} fake images\") print(f\" Image shape: {images[0].shape}\") print(f\" Sample labels: {labels[:5]}\") print(\"\\n3. Training for 5 epochs...\") for epoch in range(5): loss, acc = train_one_epoch(model, images, labels) print(f\" Epoch {epoch+1}: Loss = {loss:.4f}, Accuracy = {acc:.1f}%\") print(\"\\n4. Making predictions...\") visualize_predictions(model, images, labels) print(\"\\n5. Examining learned filters...\") filters = model.conv.weight.detach() print(f\" Filter shape: {filters.shape}\") # [3, 1, 3, 3] print(f\" First filter values:\\n{filters[0]}\") print(\"\\n=== DONE! ===\") print(\"\\nWhat we did:\") print(\"1. Created a tiny CNN with 1 conv layer + 1 fc layer\") print(\"2. Created fake image data\") print(\"3. Trained it for 5 epochs\") print(\"4. Visualized predictions\") print(\"5. Looked at learned filters\") # ========== RUN IT! ========== if __name__ == \"__main__\": main() üéØ Part 6: Understanding Each Component Through Analogies 6.1 The CNN as a Factory Assembly Line 1 2 3 4 INPUT IMAGE ‚Üí [CONV] ‚Üí [RELU] ‚Üí [POOL] ‚Üí [CONV] ‚Üí [RELU] ‚Üí [POOL] ‚Üí [FC] ‚Üí OUTPUT ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì ‚Üì Raw Find Keep Keep Find Keep Keep Make Final Material Patterns Positives Important Patterns Positives Important Decision Classification 6.2 What Each Layer Learns 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 # Let's visualize what different layers might learn def what_layers_learn(): print(\"First conv layer might learn:\") print(\" - Horizontal edges\") print(\" - Vertical edges\") print(\" - Diagonal edges\") print(\" - Blobs/corners\") print(\"\\nSecond conv layer might learn:\") print(\" - Combinations of edges ‚Üí corners\") print(\" - Simple shapes (circles, curves)\") print(\" - Texture patterns\") print(\"\\nFully connected layers learn:\") print(\" - 'If I see these patterns, it's probably a 0'\") print(\" - 'Circles at top + vertical lines = 8'\") print(\" - 'One vertical line = 1'\") 6.3 Common Questions Answered Q: Why use multiple conv layers? A: First layer sees pixels, second layer sees edges, third layer sees shapes, fourth layer sees objects.\nQ: What does ReLU do? A: It says ‚Äúignore negative evidence, only pay attention to positive evidence.‚Äù\nQ: Why pooling? A: Makes the network care less about exact position. A ‚Äú9‚Äù is still a ‚Äú9‚Äù whether it‚Äôs slightly left or right.\nQ: How many filters should I use? A: Start small (like 8-16), increase if needed. More filters = can detect more patterns, but slower.\nüìù Part 7: Your Turn - Exercises to Understand Better 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 # EXERCISE 1: Modify the TinyCNN # Try changing these and see what happens: # 1. Change number of filters from 3 to 8 # 2. Change kernel_size from 3 to 5 # 3. Remove the ReLU activation # 4. Add a second conv layer # EXERCISE 2: Count parameters def count_parameters(model): total = sum(p.numel() for p in model.parameters()) trainable = sum(p.numel() for p in model.parameters() if p.requires_grad) print(f\"Total parameters: {total:,}\") print(f\"Trainable parameters: {trainable:,}\") return total # EXERCISE 3: Create your own filter def create_edge_filter(): \"\"\"Manually create a horizontal edge detector\"\"\" filter = torch.tensor([ [1, 1, 1], [0, 0, 0], [-1, -1, -1] ]).float() # Apply it to an image manually image = torch.randn(1, 1, 5, 5) # Convolve manually output = torch.zeros(3, 3) for i in range(3): for j in range(3): patch = image[0, 0, i:i+3, j:j+3] output[i, j] = torch.sum(patch * filter) print(f\"Filter:\\n{filter}\") print(f\"Output:\\n{output}\") üöÄ Next Steps After Understanding Run the complete example above - it works! Modify one thing at a time and see what happens Try real MNIST data instead of fake data Add more layers gradually Experiment with hyperparameters (learning rate, batch size) üí° Quick Start - Just Run This: Copy and run this minimal example:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 # MINIMAL WORKING EXAMPLE - COPY AND RUN! import torch import torch.nn as nn import torch.nn.functional as F class SimpleCNN(nn.Module): def __init__(self): super().__init__() self.conv1 = nn.Conv2d(1, 4, 3, padding=1) # 4 filters self.pool = nn.MaxPool2d(2, 2) self.fc = nn.Linear(4*14*14, 10) # 10 classes def forward(self, x): x = self.pool(F.relu(self.conv1(x))) # Conv ‚Üí ReLU ‚Üí Pool x = x.view(x.size(0), -1) # Flatten x = self.fc(x) # Classify return x # Create and test model = SimpleCNN() test_input = torch.randn(2, 1, 28, 28) # Batch of 2 images output = model(test_input) print(f\"Input shape: {test_input.shape}\") print(f\"Output shape: {output.shape}\") # Should be [2, 10] print(\"Each output has 10 numbers - probabilities for digits 0-9\") ",
  "wordCount" : "3169",
  "inLanguage": "en",
  "image": "http://localhost:1313/personal_website/images/papermod-cover.png","datePublished": "2025-12-07T13:17:50+01:00",
  "dateModified": "2025-12-07T13:17:50+01:00",
  "author":{
    "@type": "Person",
    "name": "Abdul"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/personal_website/posts/how-to-build-neural-networks-from-scratch/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Abdul Rahim",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/personal_website/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/personal_website/" accesskey="h" title="Abdul Rahim (Alt + H)">Abdul Rahim</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/personal_website/archives" title="Archive">
                    <span>Archive</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/docs/resume.pdf" title="Resume">
                    <span>Resume</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/personal_website/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">



<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/personal_website/">Home</a>&nbsp;¬ª&nbsp;<a href="http://localhost:1313/personal_website/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      How to Build Neural Networks From Scratch
    </h1>
    <div class="post-meta"><span title='2025-12-07 13:17:50 +0100 CET'>December 7, 2025</span>&nbsp;¬∑&nbsp;15 min&nbsp;¬∑&nbsp;Abdul

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#-pytorch-cnn-explained-from-scratch---step-by-step" aria-label="üéì PyTorch CNN Explained from Scratch - Step by Step">üéì PyTorch CNN Explained from Scratch - Step by Step</a><ul>
                        
                <li>
                    <a href="#-part-1-the-absolute-basics---understanding-the-pieces" aria-label="üìö Part 1: The Absolute Basics - Understanding the Pieces">üìö Part 1: The Absolute Basics - Understanding the Pieces</a><ul>
                        
                <li>
                    <a href="#11-what-is-a-cnn" aria-label="1.1 What is a CNN?">1.1 What is a CNN?</a></li>
                <li>
                    <a href="#12-core-components" aria-label="1.2 Core Components">1.2 Core Components</a><ul>
                        
                <li>
                    <a href="#121-images-in-computers" aria-label="1.2.1 Images in Computers">1.2.1 Images in Computers</a></li>
                <li>
                    <a href="#122-convolution-operation" aria-label="1.2.2 Convolution Operation">1.2.2 Convolution Operation</a></li></ul>
                </li>
                <li>
                    <a href="#13-pytorch-basics---the-building-blocks" aria-label="1.3 PyTorch Basics - The Building Blocks">1.3 PyTorch Basics - The Building Blocks</a></li></ul>
                </li>
                <li>
                    <a href="#-part-2-building-a-cnn-layer-by-layer" aria-label="üèóÔ∏è Part 2: Building a CNN Layer by Layer">üèóÔ∏è Part 2: Building a CNN Layer by Layer</a><ul>
                        
                <li>
                    <a href="#21-the-complete-simple-cnn---explained-line-by-line" aria-label="2.1 The Complete Simple CNN - Explained Line by Line">2.1 The Complete Simple CNN - Explained Line by Line</a></li>
                <li>
                    <a href="#22-let" aria-label="2.2 Let&rsquo;s Visualize What Happens Step by Step">2.2 Let&rsquo;s Visualize What Happens Step by Step</a></li></ul>
                </li>
                <li>
                    <a href="#-part-3-the-complete-training-process---explained" aria-label="üéØ Part 3: The Complete Training Process - Explained">üéØ Part 3: The Complete Training Process - Explained</a><ul>
                        
                <li>
                    <a href="#31-what-does-training-actually-mean" aria-label="3.1 What Does Training Actually Mean?">3.1 What Does Training Actually Mean?</a></li>
                <li>
                    <a href="#32-the-training-loop---step-by-step" aria-label="3.2 The Training Loop - Step by Step">3.2 The Training Loop - Step by Step</a></li>
                <li>
                    <a href="#33-what-happens-during-backpropagation" aria-label="3.3 What Happens During Backpropagation?">3.3 What Happens During Backpropagation?</a></li></ul>
                </li>
                <li>
                    <a href="#-part-4-data-loading-and-preparation" aria-label="üìä Part 4: Data Loading and Preparation">üìä Part 4: Data Loading and Preparation</a><ul>
                        
                <li>
                    <a href="#41-understanding-datasets-and-dataloaders" aria-label="4.1 Understanding Datasets and DataLoaders">4.1 Understanding Datasets and DataLoaders</a></li>
                <li>
                    <a href="#42-real-mnist-data" aria-label="4.2 Real MNIST Data">4.2 Real MNIST Data</a></li></ul>
                </li>
                <li>
                    <a href="#-part-5-complete-working-example---run-this-first" aria-label="üöÄ Part 5: Complete Working Example - Run This First!">üöÄ Part 5: Complete Working Example - Run This First!</a></li>
                <li>
                    <a href="#-part-6-understanding-each-component-through-analogies" aria-label="üéØ Part 6: Understanding Each Component Through Analogies">üéØ Part 6: Understanding Each Component Through Analogies</a><ul>
                        
                <li>
                    <a href="#61-the-cnn-as-a-factory-assembly-line" aria-label="6.1 The CNN as a Factory Assembly Line">6.1 The CNN as a Factory Assembly Line</a></li>
                <li>
                    <a href="#62-what-each-layer-learns" aria-label="6.2 What Each Layer Learns">6.2 What Each Layer Learns</a></li>
                <li>
                    <a href="#63-common-questions-answered" aria-label="6.3 Common Questions Answered">6.3 Common Questions Answered</a></li></ul>
                </li>
                <li>
                    <a href="#-part-7-your-turn---exercises-to-understand-better" aria-label="üìù Part 7: Your Turn - Exercises to Understand Better">üìù Part 7: Your Turn - Exercises to Understand Better</a></li>
                <li>
                    <a href="#-next-steps-after-understanding" aria-label="üöÄ Next Steps After Understanding">üöÄ Next Steps After Understanding</a></li>
                <li>
                    <a href="#-quick-start---just-run-this" aria-label="üí° Quick Start - Just Run This:">üí° Quick Start - Just Run This:</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="-pytorch-cnn-explained-from-scratch---step-by-step">üéì <strong>PyTorch CNN Explained from Scratch - Step by Step</strong><a hidden class="anchor" aria-hidden="true" href="#-pytorch-cnn-explained-from-scratch---step-by-step">#</a></h1>
<p>I&rsquo;ll explain everything from the absolute basics. No prior PyTorch knowledge required!</p>
<h2 id="-part-1-the-absolute-basics---understanding-the-pieces">üìö <strong>Part 1: The Absolute Basics - Understanding the Pieces</strong><a hidden class="anchor" aria-hidden="true" href="#-part-1-the-absolute-basics---understanding-the-pieces">#</a></h2>
<h3 id="11-what-is-a-cnn"><strong>1.1 What is a CNN?</strong><a hidden class="anchor" aria-hidden="true" href="#11-what-is-a-cnn">#</a></h3>
<p>A <strong>Convolutional Neural Network (CNN)</strong> is like a detective that:</p>
<ol>
<li><strong>Scans</strong> an image with small filters to find patterns (edges, textures)</li>
<li><strong>Combines</strong> these patterns to recognize objects</li>
<li><strong>Learns</strong> which patterns are important for classification</li>
</ol>
<p><strong>Analogy</strong>: Imagine looking for a face in a crowd:</p>
<ul>
<li>First, you look for eyes (small patterns)</li>
<li>Then, you combine eyes+nose+mouth to find faces</li>
<li>Finally, you recognize whose face it is</li>
</ul>
<h3 id="12-core-components"><strong>1.2 Core Components</strong><a hidden class="anchor" aria-hidden="true" href="#12-core-components">#</a></h3>
<h4 id="121-images-in-computers"><strong>1.2.1 Images in Computers</strong><a hidden class="anchor" aria-hidden="true" href="#121-images-in-computers">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># An image is just a 3D array of numbers</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Shape: [Channels, Height, Width]</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Channels: 1 for grayscale, 3 for color (RGB)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example: A 28x28 grayscale MNIST digit</span>
</span></span><span class="line"><span class="cl"><span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># 1 channel, 28 height, 28 width</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Image shape: </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="122-convolution-operation"><strong>1.2.2 Convolution Operation</strong><a hidden class="anchor" aria-hidden="true" href="#122-convolution-operation">#</a></h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># A filter is like a magnifying glass that slides over the image</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It multiplies numbers and sums them up</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Example: Edge detection filter</span>
</span></span><span class="line"><span class="cl"><span class="n">filter_3x3</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># When this slides over an image:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It gives high values where there are edges (sudden changes)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># It gives low values where the image is smooth</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="13-pytorch-basics---the-building-blocks"><strong>1.3 PyTorch Basics - The Building Blocks</strong><a hidden class="anchor" aria-hidden="true" href="#13-pytorch-basics---the-building-blocks">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>  <span class="c1"># Neural network modules</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>  <span class="c1"># Functions like ReLU, softmax</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># PyTorch works with TENSORS (fancy arrays)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]])</span>  <span class="c1"># Create a 2x2 tensor</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tensor shape: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Tensor values:</span><span class="se">\n</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Neural Network Layer</span>
</span></span><span class="line"><span class="cl"><span class="n">layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">in_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">out_features</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># This creates: output = weight * input + bias</span>
</span></span><span class="line"><span class="cl"><span class="c1"># weight shape: [5, 10], bias shape: [5]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-part-2-building-a-cnn-layer-by-layer">üèóÔ∏è <strong>Part 2: Building a CNN Layer by Layer</strong><a hidden class="anchor" aria-hidden="true" href="#-part-2-building-a-cnn-layer-by-layer">#</a></h2>
<p>Let&rsquo;s build the simplest possible CNN and understand each part.</p>
<h3 id="21-the-complete-simple-cnn---explained-line-by-line"><strong>2.1 The Complete Simple CNN - Explained Line by Line</strong><a hidden class="anchor" aria-hidden="true" href="#21-the-complete-simple-cnn---explained-line-by-line">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SimpleCNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">(</span><span class="n">SimpleCNN</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>  <span class="c1"># Must call this first</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- LAYER 1: First Convolution -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Looks for simple patterns (edges, corners)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">in_channels</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>      <span class="c1"># Input has 1 channel (grayscale)</span>
</span></span><span class="line"><span class="cl">            <span class="n">out_channels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>     <span class="c1"># We want 4 different filters</span>
</span></span><span class="line"><span class="cl">            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>      <span class="c1"># Filter is 3x3 pixels</span>
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="mi">1</span>           <span class="c1"># Add 1 pixel border to keep same size</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># After this layer: [batch, 1, 28, 28] ‚Üí [batch, 4, 28, 28]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- POOLING LAYER -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Makes image smaller, keeps only important info</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Look at 2x2 blocks</span>
</span></span><span class="line"><span class="cl">            <span class="n">stride</span><span class="o">=</span><span class="mi">2</span>        <span class="c1"># Move 2 pixels each time</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># After pooling: [batch, 4, 28, 28] ‚Üí [batch, 4, 14, 14]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Takes maximum value from each 2x2 block (downsamples)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- LAYER 2: Second Convolution -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Looks for more complex patterns (combinations of edges)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">conv2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">in_channels</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>      <span class="c1"># Input has 4 channels (from previous layer)</span>
</span></span><span class="line"><span class="cl">            <span class="n">out_channels</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>     <span class="c1"># We want 8 different filters</span>
</span></span><span class="line"><span class="cl">            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>      <span class="c1"># Filter is 3x3</span>
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="mi">1</span>           <span class="c1"># Keep same size</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># After: [batch, 4, 14, 14] ‚Üí [batch, 8, 14, 14]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># After pooling: [batch, 8, 14, 14] ‚Üí [batch, 8, 7, 7]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- FLATTEN LAYER (not really a layer, just reshaping) -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Converts 3D feature maps to 1D vector</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># [batch, 8, 7, 7] ‚Üí [batch, 8 * 7 * 7] = [batch, 392]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- FULLY CONNECTED LAYER 1 -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Combines all features to make decisions</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">in_features</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span><span class="p">,</span>  <span class="c1"># 392 features from conv layers</span>
</span></span><span class="line"><span class="cl">            <span class="n">out_features</span><span class="o">=</span><span class="mi">64</span>          <span class="c1"># 64 neurons in this layer</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># ----- FINAL CLASSIFICATION LAYER -----</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># What it does: Decides which digit it is (0-9)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="n">in_features</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>     <span class="c1"># From previous layer</span>
</span></span><span class="line"><span class="cl">            <span class="n">out_features</span><span class="o">=</span><span class="mi">10</span>     <span class="c1"># 10 classes (digits 0-9)</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;This defines HOW data flows through the network&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># x shape starts as: [batch_size, 1, 28, 28]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Step 1: First convolution + activation + pooling</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># ReLU: Makes negative values 0, keeps positives</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Example: ReLU([-2, 0, 5]) = [0, 0, 5]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Step 2: Second convolution + activation + pooling</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Step 3: Flatten (3D ‚Üí 1D)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">7</span><span class="p">)</span>  <span class="c1"># -1 means &#34;figure out batch size automatically&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Step 4: First fully connected layer + activation</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Step 5: Final classification (no activation here - will add softmax later)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">x</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-let"><strong>2.2 Let&rsquo;s Visualize What Happens Step by Step</strong><a hidden class="anchor" aria-hidden="true" href="#22-let">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Create a mini network to see shapes</span>
</span></span><span class="line"><span class="cl"><span class="n">mini_cnn</span> <span class="o">=</span> <span class="n">SimpleCNN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create a fake &#34;batch&#34; of 2 images</span>
</span></span><span class="line"><span class="cl"><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">fake_images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># [2, 1, 28, 28]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Input shape: </span><span class="si">{</span><span class="n">fake_images</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Let&#39;s trace through manually</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== Tracing the CNN ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After conv1</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">fake_images</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After conv1: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 4, 28, 28]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After ReLU (just changes values, not shape)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After ReLU: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># Still [2, 4, 28, 28]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After pooling (makes it smaller)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After pool: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 4, 14, 14] - HALF the size!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After conv2</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">conv2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After conv2: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 8, 14, 14]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># After pooling again</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After pool2: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 8, 7, 7]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Flatten</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># -1 means &#34;figure out this dimension&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After flatten: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 392] (8*7*7 = 392)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Through fc1</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After fc1: </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 64]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Through fc2 (final output)</span>
</span></span><span class="line"><span class="cl"><span class="n">x</span> <span class="o">=</span> <span class="n">mini_cnn</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;After fc2 (final): </span><span class="si">{</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [2, 10]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-part-3-the-complete-training-process---explained">üéØ <strong>Part 3: The Complete Training Process - Explained</strong><a hidden class="anchor" aria-hidden="true" href="#-part-3-the-complete-training-process---explained">#</a></h2>
<h3 id="31-what-does-training-actually-mean"><strong>3.1 What Does Training Actually Mean?</strong><a hidden class="anchor" aria-hidden="true" href="#31-what-does-training-actually-mean">#</a></h3>
<p><strong>Training = Adjusting the numbers (weights) in the filters to make better predictions</strong></p>
<p>Think of it like tuning a radio:</p>
<ul>
<li>Initial random weights = static noise</li>
<li>Training = turning the dial to get clear signal</li>
<li>Good weights = clear reception</li>
</ul>
<h3 id="32-the-training-loop---step-by-step"><strong>3.2 The Training Loop - Step by Step</strong><a hidden class="anchor" aria-hidden="true" href="#32-the-training-loop---step-by-step">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Simplified training example</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">simple_train</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># 1. CREATE MODEL</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleCNN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 2. LOSS FUNCTION - Measures how wrong we are</span>
</span></span><span class="line"><span class="cl">    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># What it does: Compares predictions [0.1, 0.8, 0.1] with true label [0, 1, 0]</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Returns a single number: lower is better</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. OPTIMIZER - Adjusts the weights</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Adam: Smart gradient descent</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># lr=0.001: How big of steps to take when adjusting weights</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 4. CREATE FAKE DATA (for demonstration)</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="n">images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># Random images</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>  <span class="c1"># Random labels (digits 0-9)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Images shape: </span><span class="si">{</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Labels: </span><span class="si">{</span><span class="n">labels</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 5. ONE TRAINING STEP - Explained</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== ONE TRAINING STEP ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step A: Zero gradients (very important!)</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Why: PyTorch accumulates gradients. We need to reset them each step.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step B: Forward pass (make prediction)</span>
</span></span><span class="line"><span class="cl">    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Raw outputs shape: </span><span class="si">{</span><span class="n">outputs</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [4, 10]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Sample output: </span><span class="si">{</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step C: Calculate loss (how wrong are we?)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step D: Backward pass (figure out what to adjust)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># This calculates gradients: ‚àÇloss/‚àÇweight for EVERY weight</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Step E: Update weights (actually adjust them)</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># This does: weight = weight - lr * gradient</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Weights have been updated! Model learned a little.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">model</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Run it</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">simple_train</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-what-happens-during-backpropagation"><strong>3.3 What Happens During Backpropagation?</strong><a hidden class="anchor" aria-hidden="true" href="#33-what-happens-during-backpropagation">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Visual explanation of gradients</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">explain_gradients</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">SimpleCNN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Get one weight from the first convolution filter</span>
</span></span><span class="line"><span class="cl">    <span class="n">weight_before</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conv1</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;One weight before training: </span><span class="si">{</span><span class="n">weight_before</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Do one training step</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Fake training</span>
</span></span><span class="line"><span class="cl">    <span class="n">images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">5</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Look at the gradient for that weight</span>
</span></span><span class="line"><span class="cl">    <span class="n">gradient</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conv1</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">grad</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Gradient for that weight: </span><span class="si">{</span><span class="n">gradient</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;This tells us: Should we increase or decrease this weight?&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Positive gradient ‚Üí Decrease weight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Negative gradient ‚Üí Increase weight&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Update weights</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">weight_after</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conv1</span><span class="o">.</span><span class="n">weight</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Same weight after training: </span><span class="si">{</span><span class="n">weight_after</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Change: </span><span class="si">{</span><span class="n">weight_after</span> <span class="o">-</span> <span class="n">weight_before</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">explain_gradients</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-part-4-data-loading-and-preparation">üìä <strong>Part 4: Data Loading and Preparation</strong><a hidden class="anchor" aria-hidden="true" href="#-part-4-data-loading-and-preparation">#</a></h2>
<h3 id="41-understanding-datasets-and-dataloaders"><strong>4.1 Understanding Datasets and DataLoaders</strong><a hidden class="anchor" aria-hidden="true" href="#41-understanding-datasets-and-dataloaders">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span><span class="p">,</span> <span class="n">DataLoader</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># A Dataset is like a list of (image, label) pairs</span>
</span></span><span class="line"><span class="cl"><span class="c1"># A DataLoader gives you batches of data</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SimpleDataset</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Create your own dataset (for understanding)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Create fake data</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># Random images</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,))</span>  <span class="c1"># Random labels 0-9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">)</span>  <span class="c1"># How many samples we have</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">images</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>  <span class="c1"># Get one sample</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create dataset</span>
</span></span><span class="line"><span class="cl"><span class="n">dataset</span> <span class="o">=</span> <span class="n">SimpleDataset</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Dataset has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create DataLoader</span>
</span></span><span class="line"><span class="cl"><span class="n">dataloader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>  <span class="c1"># Give me 10 samples at a time</span>
</span></span><span class="line"><span class="cl">    <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>   <span class="c1"># Mix them up randomly</span>
</span></span><span class="line"><span class="cl">    <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span>   <span class="c1"># Don&#39;t use multiple CPU cores (for simplicity)</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># See what a batch looks like</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dataloader</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Batch </span><span class="si">{</span><span class="n">batch_idx</span><span class="si">}</span><span class="s2">:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Images shape: </span><span class="si">{</span><span class="n">images</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [10, 1, 28, 28]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Labels: </span><span class="si">{</span><span class="n">labels</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>              <span class="c1"># [10]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">batch_idx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Just look at first 3 batches</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-real-mnist-data"><strong>4.2 Real MNIST Data</strong><a hidden class="anchor" aria-hidden="true" href="#42-real-mnist-data">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">load_real_mnist</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Load actual MNIST digits&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>  <span class="c1"># Convert PIL image to tensor</span>
</span></span><span class="line"><span class="cl">        <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.1307</span><span class="p">,),</span> <span class="p">(</span><span class="mf">0.3081</span><span class="p">,))</span>  <span class="c1"># Standardize</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Download MNIST</span>
</span></span><span class="line"><span class="cl">    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">datasets</span><span class="o">.</span><span class="n">MNIST</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="n">root</span><span class="o">=</span><span class="s1">&#39;./data&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">transform</span><span class="o">=</span><span class="n">transform</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;MNIST has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> training images&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Look at one sample</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">First sample:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Image shape: </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [1, 28, 28]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Label: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>               <span class="c1"># e.g., 5</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Image min/max: </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Show the image</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Label: </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">train_dataset</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Uncomment to run</span>
</span></span><span class="line"><span class="cl"><span class="c1"># train_dataset = load_real_mnist()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-part-5-complete-working-example---run-this-first">üöÄ <strong>Part 5: Complete Working Example - Run This First!</strong><a hidden class="anchor" aria-hidden="true" href="#-part-5-complete-working-example---run-this-first">#</a></h2>
<p>Here&rsquo;s the simplest complete CNN you can run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Set random seeds for reproducibility</span>
</span></span><span class="line"><span class="cl"><span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== 1. DEFINE THE SIMPLEST CNN ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TinyCNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;The smallest possible CNN to understand&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Layer 1: Simple convolution</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 3 filters</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Layer 2: Classification</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="mi">28</span> <span class="o">*</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10 classes for digits</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Apply convolution</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Flatten</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Flatten all dimensions except batch</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Classify</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== 2. CREATE FAKE DATA ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_fake_data</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Create simple fake data for testing&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Create random &#34;images&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">images</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># Like MNIST digits</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Create random labels (0-9)</span>
</span></span><span class="line"><span class="cl">    <span class="n">labels</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="p">(</span><span class="n">num_samples</span><span class="p">,))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== 3. TRAIN FUNCTION ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train_one_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Train for one epoch (one pass through data)&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Reset gradients</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Forward pass</span>
</span></span><span class="line"><span class="cl">    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate loss</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Backward pass</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Update weights</span>
</span></span><span class="line"><span class="cl">    <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Calculate accuracy</span>
</span></span><span class="line"><span class="cl">    <span class="n">_</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">correct</span> <span class="o">=</span> <span class="p">(</span><span class="n">predictions</span> <span class="o">==</span> <span class="n">labels</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">accuracy</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== 4. VISUALIZATION ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">visualize_predictions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Show what the model predicts&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>  <span class="c1"># Set to evaluation mode</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Don&#39;t calculate gradients (faster)</span>
</span></span><span class="line"><span class="cl">        <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">images</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>  <span class="c1"># First 5 images</span>
</span></span><span class="line"><span class="cl">        <span class="n">_</span><span class="p">,</span> <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Plot</span>
</span></span><span class="line"><span class="cl">    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;True: </span><span class="si">{</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s1">Pred: </span><span class="si">{</span><span class="n">predictions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== 5. MAIN EXECUTION ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;=== CNN TUTORIAL - RUN ME! ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">1. Creating model...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">model</span> <span class="o">=</span> <span class="n">TinyCNN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Model created! It has:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  - Conv layer: 3 filters of size 3x3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  - FC layer: </span><span class="si">{</span><span class="mi">3</span><span class="o">*</span><span class="mi">28</span><span class="o">*</span><span class="mi">28</span><span class="si">}</span><span class="s2"> inputs ‚Üí 10 outputs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">2. Creating fake data...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">images</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">create_fake_data</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">images</span><span class="p">)</span><span class="si">}</span><span class="s2"> fake images&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Image shape: </span><span class="si">{</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Sample labels: </span><span class="si">{</span><span class="n">labels</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">3. Training for 5 epochs...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">loss</span><span class="p">,</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">train_one_epoch</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: Loss = </span><span class="si">{</span><span class="n">loss</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, Accuracy = </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">4. Making predictions...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">visualize_predictions</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">images</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">5. Examining learned filters...&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">filters</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">conv</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  Filter shape: </span><span class="si">{</span><span class="n">filters</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># [3, 1, 3, 3]</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;  First filter values:</span><span class="se">\n</span><span class="si">{</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">=== DONE! ===&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">What we did:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;1. Created a tiny CNN with 1 conv layer + 1 fc layer&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;2. Created fake image data&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;3. Trained it for 5 epochs&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;4. Visualized predictions&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;5. Looked at learned filters&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># ========== RUN IT! ==========</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">main</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-part-6-understanding-each-component-through-analogies">üéØ <strong>Part 6: Understanding Each Component Through Analogies</strong><a hidden class="anchor" aria-hidden="true" href="#-part-6-understanding-each-component-through-analogies">#</a></h2>
<h3 id="61-the-cnn-as-a-factory-assembly-line"><strong>6.1 The CNN as a Factory Assembly Line</strong><a hidden class="anchor" aria-hidden="true" href="#61-the-cnn-as-a-factory-assembly-line">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">INPUT IMAGE ‚Üí [CONV] ‚Üí [RELU] ‚Üí [POOL] ‚Üí [CONV] ‚Üí [RELU] ‚Üí [POOL] ‚Üí [FC] ‚Üí OUTPUT
</span></span><span class="line"><span class="cl">    ‚Üì           ‚Üì         ‚Üì        ‚Üì        ‚Üì         ‚Üì        ‚Üì       ‚Üì       ‚Üì
</span></span><span class="line"><span class="cl">  Raw       Find      Keep     Keep     Find      Keep     Keep    Make   Final
</span></span><span class="line"><span class="cl">Material  Patterns  Positives Important Patterns Positives Important Decision Classification
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="62-what-each-layer-learns"><strong>6.2 What Each Layer Learns</strong><a hidden class="anchor" aria-hidden="true" href="#62-what-each-layer-learns">#</a></h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># Let&#39;s visualize what different layers might learn</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">what_layers_learn</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;First conv layer might learn:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Horizontal edges&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Vertical edges&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Diagonal edges&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Blobs/corners&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Second conv layer might learn:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Combinations of edges ‚Üí corners&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Simple shapes (circles, curves)&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - Texture patterns&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Fully connected layers learn:&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - &#39;If I see these patterns, it&#39;s probably a 0&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - &#39;Circles at top + vertical lines = 8&#39;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;  - &#39;One vertical line = 1&#39;&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="63-common-questions-answered"><strong>6.3 Common Questions Answered</strong><a hidden class="anchor" aria-hidden="true" href="#63-common-questions-answered">#</a></h3>
<p><strong>Q: Why use multiple conv layers?</strong>
A: First layer sees pixels, second layer sees edges, third layer sees shapes, fourth layer sees objects.</p>
<p><strong>Q: What does ReLU do?</strong>
A: It says &ldquo;ignore negative evidence, only pay attention to positive evidence.&rdquo;</p>
<p><strong>Q: Why pooling?</strong>
A: Makes the network care less about exact position. A &ldquo;9&rdquo; is still a &ldquo;9&rdquo; whether it&rsquo;s slightly left or right.</p>
<p><strong>Q: How many filters should I use?</strong>
A: Start small (like 8-16), increase if needed. More filters = can detect more patterns, but slower.</p>
<h2 id="-part-7-your-turn---exercises-to-understand-better">üìù <strong>Part 7: Your Turn - Exercises to Understand Better</strong><a hidden class="anchor" aria-hidden="true" href="#-part-7-your-turn---exercises-to-understand-better">#</a></h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># EXERCISE 1: Modify the TinyCNN</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Try changing these and see what happens:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 1. Change number of filters from 3 to 8</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 2. Change kernel_size from 3 to 5</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 3. Remove the ReLU activation</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 4. Add a second conv layer</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># EXERCISE 2: Count parameters</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">count_parameters</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">trainable</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">numel</span><span class="p">()</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Total parameters: </span><span class="si">{</span><span class="n">total</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Trainable parameters: </span><span class="si">{</span><span class="n">trainable</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">total</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># EXERCISE 3: Create your own filter</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_edge_filter</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Manually create a horizontal edge detector&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">filter</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">])</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Apply it to an image manually</span>
</span></span><span class="line"><span class="cl">    <span class="n">image</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Convolve manually</span>
</span></span><span class="line"><span class="cl">    <span class="n">output</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">patch</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="n">output</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">patch</span> <span class="o">*</span> <span class="nb">filter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Filter:</span><span class="se">\n</span><span class="si">{</span><span class="nb">filter</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Output:</span><span class="se">\n</span><span class="si">{</span><span class="n">output</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="-next-steps-after-understanding">üöÄ <strong>Next Steps After Understanding</strong><a hidden class="anchor" aria-hidden="true" href="#-next-steps-after-understanding">#</a></h2>
<ol>
<li><strong>Run the complete example above</strong> - it works!</li>
<li><strong>Modify one thing at a time</strong> and see what happens</li>
<li><strong>Try real MNIST data</strong> instead of fake data</li>
<li><strong>Add more layers</strong> gradually</li>
<li><strong>Experiment with hyperparameters</strong> (learning rate, batch size)</li>
</ol>
<h2 id="-quick-start---just-run-this">üí° <strong>Quick Start - Just Run This:</strong><a hidden class="anchor" aria-hidden="true" href="#-quick-start---just-run-this">#</a></h2>
<p>Copy and run this minimal example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># MINIMAL WORKING EXAMPLE - COPY AND RUN!</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">SimpleCNN</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">conv1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 4 filters</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">pool</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MaxPool2d</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="mi">14</span><span class="o">*</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># 10 classes</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pool</span><span class="p">(</span><span class="n">F</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">conv1</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>  <span class="c1"># Conv ‚Üí ReLU ‚Üí Pool</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Flatten</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># Classify</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Create and test</span>
</span></span><span class="line"><span class="cl"><span class="n">model</span> <span class="o">=</span> <span class="n">SimpleCNN</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">test_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>  <span class="c1"># Batch of 2 images</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">test_input</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Input shape: </span><span class="si">{</span><span class="n">test_input</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Output shape: </span><span class="si">{</span><span class="n">output</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>  <span class="c1"># Should be [2, 10]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Each output has 10 numbers - probabilities for digits 0-9&#34;</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/personal_website/posts/how-does-retrieval-augmented-generation-works/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>How Does Retrieval Augmented Generation Work</span>
  </a>
  <a class="next" href="http://localhost:1313/personal_website/posts/wide_column_database_systems/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Widecolumn database systems</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on x"
            href="https://x.com/intent/tweet/?text=How%20to%20Build%20Neural%20Networks%20From%20Scratch&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f&amp;hashtags=">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f&amp;title=How%20to%20Build%20Neural%20Networks%20From%20Scratch&amp;summary=How%20to%20Build%20Neural%20Networks%20From%20Scratch&amp;source=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f&title=How%20to%20Build%20Neural%20Networks%20From%20Scratch">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on whatsapp"
            href="https://api.whatsapp.com/send?text=How%20to%20Build%20Neural%20Networks%20From%20Scratch%20-%20http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on telegram"
            href="https://telegram.me/share/url?text=How%20to%20Build%20Neural%20Networks%20From%20Scratch&amp;url=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share How to Build Neural Networks From Scratch on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=How%20to%20Build%20Neural%20Networks%20From%20Scratch&u=http%3a%2f%2flocalhost%3a1313%2fpersonal_website%2fposts%2fhow-to-build-neural-networks-from-scratch%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/personal_website/">Abdul Rahim</a></span> ¬∑ 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
